
<!-- {% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Librarian Dashboard | Inventory</title>
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <style>
        /* ADDED: Minimal style for book cover consistency */
        .book-cover {
            width: 40px; /* Small size for the table row */
            height: auto;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        /* Style classes for status based on quantity */
        .available-stock { color: green; font-weight: bold; }
        .unavailable-stock { color: red; }
    </style>
</head> 
<body>
    <div class="login-container dashboard-container">
        
        <div class="header-controls">
            <div class="header" style="text-align: left;">
                <h1>üìö Librarian Dashboard</h1>
                <p>Inventory Management and Loan Processing</p>
            </div>
            
            <div class="user-controls">
                <a href="{% url 'staff_profile' %}" class="nav-button profile-btn">
                    <i aria-hidden="true">‚öôÔ∏è</i> Profile
                </a>
                
                <a href="{% url 'staff_logout' %}" class="nav-button logout-btn">
                    <i aria-hidden="true">üö™</i> Log Out
                </a>
            </div>
        </div>

        <hr>
        
        <div class="action-buttons">
            <a href="{% url 'add_book' %}" class="action-button-primary">
                <i aria-hidden="true">‚ûï</i> Add New Book
            </a>
        </div>

        <h2>Search Inventory</h2>
        
        <form method="get" action="{% url 'dashboard' %}" class="search-area">
            <input type="text" name="q" 
                    placeholder="Search Title, Author, or ISBN..." 
                    value="{{ query|default:'' }}">
            <button type="submit" class="login-btn" style="width: 150px;">üîç Search</button>
        </form>
        
        {% if book_results %}
            <h3>Found {{ book_results|length }} Books:</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>ID</th> 
                        <th>Image</th> <th>Title</th>
                        <th>Author</th>
                        <th>ISBN</th>
                        <th>Total Stock</th> <th>Available</th> <th>Actions</th> </tr>
                </thead>
                <tbody>
                    {% for book in book_results %}
                    <tr>
                        <td>{{ book.id }}</td>

                        <td>
                            {% if book.image_url %}
                            <img src="{{ MEDIA_URL }}{{ book.image_url }}" alt="{{ book.title }} Coverr" class="book-cover">
                            {% else %}
                            <i aria-hidden="true">üñºÔ∏è</i>
                            {% endif %}
                        </td>
                        
                        <td>{{ book.title }}</td>
                        <td>{{ book.author }}</td>
                        <td>{{ book.isbn }}</td>
                        
                        <td>{{ book.total_copies }}</td> <td class="{% if book.available_copies > 0 %}available-stock{% else %}unavailable-stock{% endif %}">
                            {{ book.available_copies }}
                        </td>

                        <td>
                            {% if book.available_copies > 0 %}
                            <a href="" class="action-link available-stock">Borrow</a>
                            {% else %}
                            <a href="{% url 'return_book' %}?book_id={{ book.id }}" class="action-link unavailable-stock">Return</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="text-align: center;">No results found for query "{{ query }}".</p>
        {% endif %}

    </div>
</body>
</html> -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Librarian Dashboard | Inventory</title>
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}?v=3">
    <style>
        /* Extra table styles that were inlined before */
        .book-cover {
            width: 40px;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .available-stock { color: green; font-weight: bold; }
        .unavailable-stock { color: red; }
    </style>
</head>
<body class="dashboard-page">

<!-- ================= PROFILE SIDE PANEL ================= -->
<div class="profile-panel" id="profilePanel">
    <!-- dark overlay -->
    <div class="profile-panel-overlay" id="profileOverlay"></div>

    <!-- sliding card -->
    <aside class="profile-panel-body">
        <div class="profile-panel-header">
            <button type="button" class="profile-panel-close" id="profileClose">√ó</button>

            <div class="profile-panel-user">
                <div class="profile-panel-avatar">üë§</div>
                <div>
                    <p class="profile-panel-name">
                        {{ username|default:"Librarian" }}
                    </p>
                    <p class="profile-panel-handle">
                        @{{ username|default:"librarian" }}
                    </p>
                </div>
            </div>

            <a href="{% url 'staff_profile' %}" class="profile-panel-edit-btn">
                Edit Profile
            </a>
        </div>

        <nav class="profile-panel-menu">
            <button type="button"
                    class="profile-panel-item"
                    onclick="window.location.href='{% url 'staff_profile' %}'">
                <span>Profile</span>
                <span class="profile-panel-arrow">‚Ä∫</span>
            </button>

            <button type="button"
                    class="profile-panel-item profile-panel-item-danger"
                    onclick="window.location.href='{% url 'staff_logout' %}'">
                <span>Log out</span>
                <span class="profile-panel-arrow">‚Ä∫</span>
            </button>
        </nav>
    </aside>
</div>
<!-- ===================================================== -->

<div class="dashboard-layout">

    <!-- ========== LEFT SIDEBAR ========== -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-logo">
     <img src="{{ MEDIA_URL }}{{ logo_image }}" 
         alt="ISMAC Logo"
         class="logo-img">
</div>

        <nav class="sidebar-nav">
            <p class="sidebar-section-label">LIBRARY</p>

            <a href="{% url 'dashboard' %}" class="sidebar-link active">
                Dashboard
            </a>

            <a href="{% url 'add_book' %}" class="sidebar-link">
                Add New Book
            </a>

            <a href="#" class="sidebar-link">
                Borrowed Books
            </a>
            <a href="{% url 'users_list' %}" class="sidebar-link">
                üìñ Users
            </a>
            <a href="{% url 'clients_list' %}" class="sidebar-link">
                üë• Clients
            </a>
          <a href="{% url 'loan_list' %}" class="sidebar-link">
                üìö Emprunts
            </a>


            
            <!-- <a href="#" class="sidebar-link">
                {% comment %}  Returns {% endcomment %}
            </a> -->

            <p class="sidebar-section-label">ACCOUNT</p>

            <a href="{% url 'staff_profile' %}" class="sidebar-link">
                üë§ My Profile
            </a>
        </nav>
    </aside>

    <!-- ========== MAIN AREA ========== -->
    <main class="dashboard-main">
        <div class="dashboard-main-inner">

            <!-- TOP BAR -->
            <header class="topbar">
                <div class="topbar-search">
                    <input type="text" placeholder="Search in dashboard...">
                </div>

                <div class="topbar-user">
                    <span class="topbar-username">{{ username|default:"Librarian" }}</span>
                    <!-- button that opens the side panel -->
                    <button type="button"
                            class="topbar-avatar-btn"
                            id="profileToggle">
                        üë§
                    </button>
                </div>
            </header>

            <!-- HERO BANNER -->
            <section class="hero-banner">
                <div class="hero-text-block">
                    <p class="hero-eyebrow">Dashboard</p>
                    <h1 class="hero-title">üëã Bonjour, {{ username|default:"Librarian" }} !</h1>
                    <p class="hero-subtitle">
                        Welcome to your library space. Manage books, track loans, and keep your catalog organized.
                    </p>
                </div>

                <div class="hero-actions">
                    <!-- keep your existing Profile / Log Out buttons if you like 
                    <div class="hero-user-controls">
                        <a href="{% url 'staff_profile' %}" class="nav-button profile-btn">
                            ‚öôÔ∏è Profile
                        </a>
                        <a href="{% url 'staff_logout' %}" class="nav-button logout-btn">
                            üö™ Log Out
                        </a>
                    </div>-->
                </div>
            </section>

            <!-- SUMMARY CARDS -->
            <section class="summary-row">
                <article class="summary-card">
                    <h3>Books in Catalog</h3>
                    <p class="summary-number">
                        {{ book_results|length|default:"0" }}
                    </p>
                    <p class="summary-caption">
                        Total books found in current search.
                    </p>
                </article>

                <article class="summary-card">
                    <h3>Available Now</h3>
                    <p class="summary-number">
                        {{ book_results|length|default:"0" }}
                    </p>
                    <p class="summary-caption">
                        Copies currently available (visual placeholder).
                    </p>
                </article>

                <article class="summary-card">
                    <h3>Notifications</h3>
                    <p class="summary-number">0</p>
                    <p class="summary-caption">
                        No notifications for now.
                    </p>
                </article>
            </section>

            <!-- SEARCH SECTION -->
            <section class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">Search Inventory</h2>
                </div>

                <form method="get"
                      action="{% url 'dashboard' %}"
                      class="search-area">
                    <input type="text"
                           name="q"
                           placeholder="Search Title, Author, or ISBN..."
                           value="{{ query|default:'' }}">
                    <button type="submit" class="login-btn search-btn">
                        üîç Search
                    </button>
                </form>
            </section>

            <!-- RESULTS TABLE -->
            <section class="dashboard-section">
                {% if book_results %}
                    <h3 class="section-subtitle">
                        Found {{ book_results|length }} Books:
                    </h3>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Image</th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>ISBN</th>
                                    <th>Total Stock</th>
                                    <th>Available</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for book in book_results %}
                                <tr>
                                    <td>{{ book.id }}</td>
                                    <td>
                                        {% if book.image_url %}
                                            <img src="{{ MEDIA_URL }}{{ book.image_url }}"
                                                 alt="{{ book.title }} Cover"
                                                 class="book-cover">
                                        {% else %}
                                            üñºÔ∏è
                                        {% endif %}
                                    </td>
                                    <td>{{ book.title }}</td>
                                    <td>{{ book.author }}</td>
                                    <td>{{ book.isbn }}</td>
                                    <td>{{ book.total_copies }}</td>
                                    <td class="{% if book.available_copies > 0 %}available-stock{% else %}unavailable-stock{% endif %}">
                                        {{ book.available_copies }}
                                    </td>
                                    <td>
                                        {% if book.available_copies > 0 %}
                                            <a href="#" class="action-link available-stock">
                                                Borrow
                                            </a>
                                        {% else %}
                                            <a href="{% url 'return_book' %}?book_id={{ book.id }}"
                                               class="action-link unavailable-stock">
                                                Return
                                            </a>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="no-results">
                        No results found for query "{{ query }}".
                    </p>
                {% endif %}
            </section>

        </div>
    </main>
</div>

<!-- =============== JS: open / close side panel =============== -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const panel     = document.getElementById('profilePanel');
    const toggleBtn = document.getElementById('profileToggle');
    const closeBtn  = document.getElementById('profileClose');
    const overlay   = document.getElementById('profileOverlay');

    if (!panel || !toggleBtn) return;

    function openPanel()  { panel.classList.add('open'); }
    function closePanel() { panel.classList.remove('open'); }

    toggleBtn.addEventListener('click', function () {
        panel.classList.toggle('open');
    });

    [closeBtn, overlay].forEach(function (el) {
        if (el) { el.addEventListener('click', closePanel); }
    });
});
</script>
</body>
</html>